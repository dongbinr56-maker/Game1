# 게임 기획서 (GDD)

## 1) 게임 개요

### 1.1 한 줄 요약

도트풍 카페를 운영하며 손님 흐름을 최적화하고, 직원/장비/인테리어를 확장해 "작은 카페 → 로컬 프랜차이즈"로 성장시키는 세로형 방치/경영 게임.

### 0) 고정 스펙 확정 (좌표/타일/맵)

- **가상 해상도(월드 좌표):** `288 × 512`
- **타일 크기:** `16 × 16`
- **그리드 개수:** 가로 18(288/16), 세로 32(512/16)
- **맵:** 스크롤 없는 1화면 카페(18×32 타일) 고정
- 목적: 모든 리소스/배치/터치 판정을 정수 픽셀 기준으로 단순화

### 1.1.1 핵심 KPI 초안

- 튜토리얼 완료율(D0): 85%+
- D1 Retention: 40% 목표(소프트 런치 기준)
- 첫 업그레이드 달성까지 시간: 60초 이내
- 평균 세션 길이: 3~5분(오토/방치 플레이 포함)
- 세션당 업그레이드 구매 횟수: 3회+

### 1.2 플레이어 경험 목표

- **30초:** "돈 벌리는 느낌" 즉시 제공(첫 주문, 첫 업그레이드)
- **3분:** 손님 동선/대기열/좌석의 병목을 이해하고 개선
- **30분:** 직원/장비/메뉴의 생산 체인을 구축
- **7일:** 신규 구역(테라스/로스팅룸/베이커리) 확장, 장기 성장 동기 확보

### 1.3 타깃/플랫폼

- 플랫폼: iOS/Android, 세로 고정
- 플레이 세션: 짧게 1~5분 반복 + 하루 1~2회 오프라인 정산
- 접근성: 글자 큰 UI, 단순한 버튼, 저사양에서도 부드럽게

### 1.4 핵심 게임 루프 (Core Loop)

손님 유입 → 주문 생성 → 제조/서빙(직원 자동) → 결제 수익 → 업그레이드(좌석/장비/직원/메뉴) → 처리량 증가 → 반복

### 1.5 메타 루프 (Meta Progression)

- 카페 등급(레벨) 상승 → 신규 메뉴/직원/구역/인테리어 해금
- 평판(Stars) 시스템: 처리 속도/만족도에 따라 보상 배수, 이벤트 해금
- 컬렉션/도감: 메뉴, 손님 타입, 인테리어 세트 수집(코스메틱 중심)

### 1.6 게임 시스템 상세

#### A. 손님/주문 시스템

- **손님 생성(스폰) 규칙:** 기본 스폰 분당 N명, 혼잡 시 스폰 조절
- **손님 상태 머신:** Enter → Queue → Seat(또는 Takeout) → Order → Wait → Receive → Pay → Leave
- **주문 구성:** 메뉴 1개(기본) → 등급 상승 시 2개(콤보), 옵션 추가(샷 추가 등)
- **대기/인내심:** 손님 타입별 기본 인내심(초) + 업그레이드/인테리어 보너스로 증가

#### B. 제조/서빙 자동화 (직원 AI)

- **직원 역할:** 바리스타(제조), 서버(서빙/정리), 캐셔(결제/포장)
- **스킬:** 속도, 멀티태스킹, 이동속도, 오류율(초반 단순화 가능)
- **할당 UI:** 역할 슬롯에 드래그/탭 배치
- **성장 곡선 예시:** 기본 속도 1.0x, 레벨업당 10% 가속(소프트 캡 2.5x), 멀티태스킹은 2레벨마다 +1 슬롯(최대 4)
- **피로/오류:** 장기 세션 대비 오토 방치 중심이라 단순화(피로 없음, 오류율 최소값 유지)

#### C. 좌석/동선/병목

- 병목 요소: 좌석 수, 제조대 처리량, 결제 처리량, 테이블 정리 속도
- 병목 가시화: 상단 HUD 처리량 지표(예: 분당 주문 처리 12/분, 대기열 8명)
- 병목 발생 시 추천: "캐셔 업그레이드하면 대기 감소"
- 좌석 배치와 동선 충돌 최소화를 위해 타일 기반 경로(waypoint) 유지

#### D. 재화/경제 밸런스 (초안)

- 기본 재화: 코인(운영 수익)
- 보조 재화: 재료(원두/우유/시럽) — "구매/공급" 여부는 난이도 조절용
- 프리미엄: "토큰/티켓" 등 코스메틱/확장팩 용도, 랜덤형 지양
- **가격/수익 기본식:** 업그레이드 가격 `base * (1 + growth)^(level-1)` (growth 0.12~0.18), 주문 수익 `menuBase * (1 + repBonus)` (repBonus: 평판 계수)

#### E. 오프라인 진행 (Idle 필수)

- 저장 시점: lastSavedAt, 핵심 상태(재화, 업그레이드, 직원, 진행도)
- 재접속 계산: elapsed = now - lastSavedAt, 오프라인 생산 = min(elapsed, cap) × 분당 생산량
- cap(상한): 8~24시간 중 택1
- 오프라인 보정 UI: "오프라인 수익 정산" 팝업 + 상세(벌이 및 이유)
- **안전장치:** 디바이스 시간 역행 시 0으로 처리, cap 초과 시 경고 문구 제공
- **예시:** cap=12h, 분당 120코인 생산 → 최대 86,400 코인 지급

#### F. 콘텐츠 로드맵 (예시)

- **구역:** 작은 카페 → 테라스 → 베이커리 → 로스팅룸 → 2호점
- **메뉴:** 아메리카노/라떼/초코 → 티/디저트 → 시그니처
- **손님 타입:** 학생/직장인/커플/단골/관광객(주문 속도, 인내심, 팁 상이)

### 1.7 UX/UI (세로 고정 레이아웃)

- 상단 HUD: 코인, 평판, 처리량, 설정
- 중앙: 카페 도트맵(손님/직원 이동)
- 하단 탭: [업그레이드] [직원] [메뉴] [인테리어] [미션]
- 접근성: 버튼 최소 44px, 큰 폰트와 대비, 과한 애니메이션 지양

### 1.8 수익화 (안전/정책 리스크 최소화)

- 코스메틱 직접 구매, 광고 제거, 확장팩 판매
- 보호자 게이트 권장: 구매 진입 시 길게 누르기 + 간단한 수학 문제
- 구매/외부링크/개인정보 관련은 모두 게이트 뒤로 배치

## 2) 기술 설계 (Flutter + Flame 기준)

### 2.1 아키텍처 분리

- **core/**: 시뮬레이션, 경제, 업그레이드, 오프라인 정산 (단위 테스트 용이)
- **game/**: Flame 렌더링/입력, 스프라이트/애니메이션, 카메라/히트박스
- **app/**: Flutter UI(HUD, 탭, 팝업, 상점, 설정)
- **data/**: 저장/버전(Hive/SQLite), 마이그레이션

### 2.2 성능/그래픽 원칙 (픽셀 퍼펙트)

- 내부 가상 해상도(예: 360×640 또는 320×568) 고정, 정수 배율 스케일 + nearest 필터
- 텍스처 아틀라스 사용
- 프레임 루프: 렌더 60fps, 시뮬레이션은 1초(또는 0.5초) 틱 분리
- **실제 적용:** CameraComponent.withFixedResolution(288, 512)로 고정, 비율 불일치 시 레터박스 허용
- **안티앨리어싱/필터:** FilterQuality.none 및 앤티앨리어싱 비활성화로 최근접 샘플링 유지
- **타일 경계 실금 방지:** 타일셋/스프라이트시트에 1~2px 패딩 또는 extrude 처리

### 2.3 데이터 (세이브 스키마 초안)

- player: 레벨, 평판, 코인, 해금
- cafe: 좌석/장비 레벨, 배치 정보
- staff: 직원 목록(레벨, 역할, 스탯)
- time: lastSavedAt, lastRewardClaimAt
- version: saveVersion

### 2.4 운영 (선택 기능)

- 크래시 리포트(Crashlytics 등)
- 리모트 밸런스(Remote Config)
- 최소 이벤트 기반 분석(개인정보/광고 식별자 보수적 활용)

## 3) 프로젝트 실행 계획 (마일스톤)

### Phase 0. 프리프로덕션 (1~2주)

- 산출물: GDD v1, 세로 UI 와이어프레임, 픽셀 아트 가이드, 기술 스파이크 결과
- 핵심 결정: 가상 해상도, 타일 크기, 시뮬레이션 틱(1초), 오프라인 cap(예: 12시간)
- **추가:** Flutter + Flame 진행(유니티 미사용), flame `^1.34.0`, flame_tiled `^3.0.9`

### Phase 1. MVP (4~6주)

- 목표: "재미의 뼈대" 동작
- 포함: 손님/주문/제조/결제 전체 루프, 업그레이드 5~10개, 오프라인 정산, 기본 UI, 세이브/로드 안정화
- 완료 기준: 30분 플레이 안정, 10회 재실행 데이터 일관성, 2시간 이상 성장 곡선 유지

### Phase 2. 알파 (3~4주)

- 목표: 콘텐츠/연출/밸런스 확보
- 포함: 구역 2개, 메뉴 10개, 직원 3명 역할 분화, 미션/업적, 병목 피드백 UI, 튜토리얼
- 완료 기준: D1 재접속 동기, 튜토리얼 이탈 측정 가능

### Phase 3. 베타/소프트런치 (3~6주)

- 목표: 출시 품질 + 정책/수익화 안전
- 포함: 상점(코스메틱/광고 제거/확장팩) + 부모 게이트, 스토어 심사 대응, 크래시/성능 최적화, 리모트 밸런스
- 완료 기준: 크래시율/치명 버그 최소화, 결제 플로우 안정, 스토어 제출 준비 완료

### Phase 4. 정식 런칭 + 라이브 운영 (지속)

- FOMO보다 기념/꾸미기/추가 콘텐츠 중심 이벤트
- 신규 구역/메뉴/인테리어 세트 주기적 추가

## 4) End-to-End 체크리스트 (출시 전 구간)

### 4.1 기획/디자인 체크

- 코어 루프 30초 체감
- 병목 가시화(대기열/처리량)
- 오프라인 정산 숫자 설명 가능
- 과금 요소의 명확한 가치, 랜덤/압박 지양
- 미성년자 보호(부모 게이트, 권유 문구 절제)

### 4.2 기술/코드 체크

- 시뮬레이션(core)과 렌더(game) 완전 분리
- 1초 틱 경제 업데이트(프레임 의존 제거)
- 세이브 버전/마이그레이션 처리
- 오프라인 정산 cap 및 예외 처리
- 저사양에서 목표 fps 유지, 메모리/텍스처 관리
- fixed resolution 카메라 적용 확인(288×512), 입력 좌표 어긋남 여부 점검
- FilterQuality.none/패딩 처리로 픽셀 번짐/실금 없는지 확인
- Tiled 맵 18×32, 타일 16×16 정확히 로드되는지 확인

### 4.3 품질/테스트 체크

- 핵심 로직 단위 테스트(오프라인 정산, 업그레이드 가격, 수익 계산)
- 저장/로드 반복 내구 테스트(50회)
- 디바이스 다양성 테스트(저사양 안드로이드, 최신 iOS)
- 튜토리얼 이탈/버그 케이스 재현 로그 확보

### 4.4 스토어/정책 체크 (iOS/Android)

- 개인정보처리방침/약관 준비 및 앱 내 링크
- 권한 최소화
- 결제 상품 구성/가격/설명 투명성
- 연령등급/콘텐츠 등급 제출
- 광고 사용 시 아동/가족 정책 준수(가능하면 광고 최소화)

### 4.5 런칭 운영 체크

- 크래시/로그 모니터링 대시보드
- 밸런스 리모트 조정 체계
- CS 대응 템플릿(결제 복구, 데이터 복구, 버그 신고)
- 업데이트 배포 플로우(릴리즈 노트, 롤백 플랜)

## 5) 세부 ToDo (티켓화 가능 단위)

### 5.1 프리프로덕션 ToDo

- GDD-001 게임 핵심 지표 정의(처리량/대기열/만족도)
- GDD-002 가상 해상도/타일 크기/팔레트 확정
- UX-001 세로 UI 와이어프레임(상단 HUD/중앙 월드/하단 탭)
- ART-001 스프라이트 규격(캐릭터 4방향 여부, 2프레임/4프레임)
- TECH-001 Flame 픽셀 퍼펙트 렌더 POC
- TECH-002 세이브/로드(Hive/SQLite) POC
- TECH-003 오프라인 정산 POC(시간 차 계산/캡/예외)

### 5.2 MVP ToDo (코어 루프)

- CORE-001 경제 모델 v1(코인, 가격곡선, 수익공식)
- CORE-002 손님 상태 머신 구현
- CORE-003 주문 생성/처리 로직 구현
- CORE-004 직원 역할(바리스타/캐셔 최소 2개) 및 자동 처리
- GAME-001 카페 맵(타일/오브젝트) 렌더링
- GAME-002 손님/직원 이동(간단 경로: waypoint 기반)
- GAME-003 인터랙션: 탭으로 "수익 수금/업그레이드 구매"
- APP-001 상단 HUD(코인/처리량/설정)
- APP-002 하단 탭 2개(업그레이드/직원)
- DATA-001 세이브 스키마 v1 + 저장 트리거(앱 백그라운드)
- DATA-002 오프라인 정산 적용 + 정산 팝업
- QA-001 저장/로드 내구 테스트 시나리오 문서화

### 5.3 알파 ToDo (콘텐츠/연출)

- CONTENT-001 메뉴 10개/재료 간소 체인(선택)
- CONTENT-002 구역 확장(테라스) + 해금 조건
- UX-002 튜토리얼 1단계(첫 주문/첫 업그레이드)
- UX-003 병목 진단 UI(대기열 경고, 추천 업그레이드)
- GAME-004 애니메이션(제조/서빙/결제) 최소 연출
- APP-003 미션/업적 화면 + 보상 지급
- QA-002 저사양 성능 최적화 1차(텍스처/업데이트 주기)

### 5.4 베타/소프트런치 ToDo (출시 품질)

- MON-001 코스메틱 상점(직접 구매)
- MON-002 광고 제거 상품(복원/구매 복구)
- MON-003 확장팩(신규 구역/세트) 상품화
- SAFE-001 보호자 게이트(구매 진입/외부 링크/설정)
- POL-001 개인정보처리방침/약관 문구/앱 내 노출
- OPS-001 크래시/로그 수집(최소화된 분석)
- BAL-001 리모트 밸런스(가격/수익 계수)
- QA-003 결제 플로우 테스트(iOS/Android)
- REL-001 스토어 스크린샷/영상/설명 문구 작성
- REL-002 내부/클로즈드 테스트 배포(TestFlight/Play Console)

### 5.5 런칭 이후 운영 ToDo

- LIVE-001 주간 인테리어 세트 추가(코스메틱)
- LIVE-002 신규 구역 로드맵(월 1개 목표 등)
- LIVE-003 밸런스 패치 프로세스(지표 기반)
- CS-001 결제 복구/세이브 복구 가이드

## 6) 픽셀 고정 렌더링/카메라 가이드

- **카메라:** `CameraComponent.withFixedResolution(width: 288, height: 512)` 사용
- **레터박스:** 기기 비율과 다르면 검은 여백 허용
- **입력:** CameraComponent 기반 설정으로 FixedResolutionViewport 입력 어긋남 회피
- **필터:** Sprite/이미지 로드시 가능한 경우 `filterQuality: FilterQuality.none`

## 7) 맵 제작/에셋 규칙

- **맵:** Tiled(.tmx) 18×32 타일, 타일 크기 16×16
- **레이어 컨벤션:** Floor, Walls, Decor, Spawns(오브젝트: 입구/카운터 등)
- **로드:** `TiledComponent.load('cafe_01.tmx', Vector2.all(16))` with `flame_tiled`
- **패딩:** 타일/스프라이트시트는 1~2px 패딩 또는 extrude로 실금 방지
- **폴더 예시:** assets/images/tiles, assets/images/sprites, assets/maps

## 8) “완전 단순(코인만)” 자동 방치형 카페 루프

### 생산 루프
- 손님 주기적 등장 → 주문/제조 → 결제(코인 증가)
- 처리량은 스폰 속도, 제조 속도, 동시 처리량으로 결정

### 성장 루프(코인 전용 업그레이드 3종)
- 손님 등장 속도 업그레이드
- 제조 속도 업그레이드
- 최대 동시 처리(대기열/테이블 수) 업그레이드

### 오프라인 보상(선택)
- 종료 시간 저장 → 재접속 시 경과 시간만큼 코인 지급, 상한 포함

## 9) 실행 순서형 E2E 체크리스트 (바로 시작)

### Sprint 0: 세팅/뼈대
- [ ] Flutter 프로젝트 생성, `flame`, `flame_tiled` 추가
- [ ] 세로 고정 `SystemChrome.setPreferredOrientations`
- [ ] `GameWidget` + `CafeGame` 구성, 카메라 fixed 288×512
- [ ] 기본 Paint 필터 정책(FilterQuality.none) 적용

### Sprint 1: 맵 1장 + 상호작용 최소
- [ ] Tiled 맵 18×32 생성, 레이어 규칙 적용
- [ ] `cafe_01.tmx` 로드 및 입구/카운터 좌표 파싱

### Sprint 2: 자동 방치 루프(코인)
- [ ] 손님 스폰 타이머, 대기열 큐
- [ ] 제조 진행률 처리, 완료 시 코인 증가
- [ ] HUD 코인 표시

### Sprint 3: 업그레이드 3개
- [ ] 버튼/가격 증가식(예: 50→120→300…)
- [ ] 파라미터 반영(스폰/속도/용량)
- [ ] 저장/불러오기(로컬) 적용

### Sprint 4: 폴리싱/출시
- [ ] 튜토리얼 문구 3줄
- [ ] 사운드/진동(선택), 프레임/메모리 점검
- [ ] 스토어 빌드/심사 대응

## 10) 바로 실행용 코드 뼈대 (Flutter + Flame, 288×512 고정)

```dart
// main.dart
import 'package:flutter/material.dart';
import 'package:flutter/services.dart';
import 'package:flame/game.dart';
import 'src/cafe_game.dart';

void main() async {
  WidgetsFlutterBinding.ensureInitialized();
  await SystemChrome.setPreferredOrientations([DeviceOrientation.portraitUp]);
  await SystemChrome.setEnabledSystemUIMode(SystemUiMode.immersiveSticky);
  runApp(GameWidget(game: CafeGame()));
}
```

```dart
// src/cafe_game.dart
import 'package:flame/components.dart';
import 'package:flame/game.dart';

class CafeGame extends FlameGame {
  CafeGame()
      : super(
          camera: CameraComponent.withFixedResolution(
            width: 288,
            height: 512,
          ),
        );

  @override
  Future<void> onLoad() async {
    // TODO:
    // 1) flame_tiled로 맵 로드
    // 2) 스프라이트/오브젝트 배치
    // 3) 생산/업그레이드 루프 초기화
  }
}
```

## 11) 안전한 수익화 원칙

- 전 연령 대상 코스메틱/확장팩 중심, 과도한 권유/다크 패턴 배제
- 부모 게이트/명확한 결제 고지 유지, 아동 보호/스토어 정책 준수
